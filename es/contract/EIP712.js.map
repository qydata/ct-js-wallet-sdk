{"version":3,"file":"EIP712.js","names":["DOMAIN_TYPE","type","name","ethUtil","require","module","exports","createTypeData","domainData","primaryType","message","types","Object","assign","EIP712Domain","domain","signTypedData","web3","from","data","Promise","resolve","reject","cb","err","result","error","sig","sig0","substring","r","addHexPrefix","s","v","parseInt","currentProvider","isMetaMask","sendAsync","jsonrpc","method","params","JSON","stringify","id","Date","getTime","send","bind"],"sources":["../../src/contract/EIP712.js"],"sourcesContent":["const DOMAIN_TYPE = [\n  {\n    type: 'string',\n    name: 'name'\n  },\n  {\n    type: 'string',\n    name: 'version'\n  },\n  {\n    type: 'uint256',\n    name: 'chainId'\n  },\n  {\n    type: 'address',\n    name: 'verifyingContract'\n  }\n]\nconst ethUtil = require('ethereumjs-util')\nmodule.exports = {\n  createTypeData: function (domainData, primaryType, message, types) {\n    return {\n      types: Object.assign({\n        EIP712Domain: DOMAIN_TYPE\n      }, types),\n      domain: domainData,\n      primaryType: primaryType,\n      message: message\n    }\n  },\n\n  signTypedData: function (web3, from, data) {\n\n    return new Promise(async (resolve, reject) => {\n      function cb(err, result) {\n        if (err) {\n          return reject(err)\n        }\n        if (result.error) {\n          return reject(result.error)\n        }\n\n        const sig = result.result\n        const sig0 = sig.substring(2)\n        const r = ethUtil.addHexPrefix(sig0.substring(0, 64))\n        const s = ethUtil.addHexPrefix(sig0.substring(64, 128))\n        const v = parseInt(sig0.substring(128, 130), 16)\n\n        resolve({\n          data,\n          sig,\n          v, r, s\n        })\n      }\n\n      if (web3.currentProvider.isMetaMask) {\n        web3.currentProvider.sendAsync({\n          jsonrpc: '2.0',\n          method: 'eth_signTypedData_v4',\n          params: [from, JSON.stringify(data)],\n          id: new Date().getTime()\n        }, cb)\n      }\n      else {\n        let send = web3.currentProvider.sendAsync\n        if (!send) send = web3.currentProvider.send\n        send.bind(web3.currentProvider)({\n          jsonrpc: '2.0',\n          method: 'eth_signTypedData',\n          params: [from, data],\n          id: new Date().getTime()\n        }, cb)\n      }\n    })\n  }\n}\n"],"mappings":"AAAA,MAAMA,WAAW,GAAG,CAClB;EACEC,IAAI,EAAE,QAAQ;EACdC,IAAI,EAAE;AACR,CAAC,EACD;EACED,IAAI,EAAE,QAAQ;EACdC,IAAI,EAAE;AACR,CAAC,EACD;EACED,IAAI,EAAE,SAAS;EACfC,IAAI,EAAE;AACR,CAAC,EACD;EACED,IAAI,EAAE,SAAS;EACfC,IAAI,EAAE;AACR,CAAC,CACF;AACD,MAAMC,OAAO,GAAGC,OAAO,CAAC,iBAAiB,CAAC;AAC1CC,MAAM,CAACC,OAAO,GAAG;EACfC,cAAc,EAAE,SAAAA,CAAUC,UAAU,EAAEC,WAAW,EAAEC,OAAO,EAAEC,KAAK,EAAE;IACjE,OAAO;MACLA,KAAK,EAAEC,MAAM,CAACC,MAAM,CAAC;QACnBC,YAAY,EAAEd;MAChB,CAAC,EAAEW,KAAK,CAAC;MACTI,MAAM,EAAEP,UAAU;MAClBC,WAAW,EAAEA,WAAW;MACxBC,OAAO,EAAEA;IACX,CAAC;EACH,CAAC;EAEDM,aAAa,EAAE,SAAAA,CAAUC,IAAI,EAAEC,IAAI,EAAEC,IAAI,EAAE;IAEzC,OAAO,IAAIC,OAAO,CAAC,OAAOC,OAAO,EAAEC,MAAM,KAAK;MAC5C,SAASC,EAAEA,CAACC,GAAG,EAAEC,MAAM,EAAE;QACvB,IAAID,GAAG,EAAE;UACP,OAAOF,MAAM,CAACE,GAAG,CAAC;QACpB;QACA,IAAIC,MAAM,CAACC,KAAK,EAAE;UAChB,OAAOJ,MAAM,CAACG,MAAM,CAACC,KAAK,CAAC;QAC7B;QAEA,MAAMC,GAAG,GAAGF,MAAM,CAACA,MAAM;QACzB,MAAMG,IAAI,GAAGD,GAAG,CAACE,SAAS,CAAC,CAAC,CAAC;QAC7B,MAAMC,CAAC,GAAG3B,OAAO,CAAC4B,YAAY,CAACH,IAAI,CAACC,SAAS,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC;QACrD,MAAMG,CAAC,GAAG7B,OAAO,CAAC4B,YAAY,CAACH,IAAI,CAACC,SAAS,CAAC,EAAE,EAAE,GAAG,CAAC,CAAC;QACvD,MAAMI,CAAC,GAAGC,QAAQ,CAACN,IAAI,CAACC,SAAS,CAAC,GAAG,EAAE,GAAG,CAAC,EAAE,EAAE,CAAC;QAEhDR,OAAO,CAAC;UACNF,IAAI;UACJQ,GAAG;UACHM,CAAC;UAAEH,CAAC;UAAEE;QACR,CAAC,CAAC;MACJ;MAEA,IAAIf,IAAI,CAACkB,eAAe,CAACC,UAAU,EAAE;QACnCnB,IAAI,CAACkB,eAAe,CAACE,SAAS,CAAC;UAC7BC,OAAO,EAAE,KAAK;UACdC,MAAM,EAAE,sBAAsB;UAC9BC,MAAM,EAAE,CAACtB,IAAI,EAAEuB,IAAI,CAACC,SAAS,CAACvB,IAAI,CAAC,CAAC;UACpCwB,EAAE,EAAE,IAAIC,IAAI,CAAC,CAAC,CAACC,OAAO,CAAC;QACzB,CAAC,EAAEtB,EAAE,CAAC;MACR,CAAC,MACI;QACH,IAAIuB,IAAI,GAAG7B,IAAI,CAACkB,eAAe,CAACE,SAAS;QACzC,IAAI,CAACS,IAAI,EAAEA,IAAI,GAAG7B,IAAI,CAACkB,eAAe,CAACW,IAAI;QAC3CA,IAAI,CAACC,IAAI,CAAC9B,IAAI,CAACkB,eAAe,CAAC,CAAC;UAC9BG,OAAO,EAAE,KAAK;UACdC,MAAM,EAAE,mBAAmB;UAC3BC,MAAM,EAAE,CAACtB,IAAI,EAAEC,IAAI,CAAC;UACpBwB,EAAE,EAAE,IAAIC,IAAI,CAAC,CAAC,CAACC,OAAO,CAAC;QACzB,CAAC,EAAEtB,EAAE,CAAC;MACR;IACF,CAAC,CAAC;EACJ;AACF,CAAC"}